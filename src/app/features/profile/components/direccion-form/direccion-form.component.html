<div class="direccion-form-container">
  <h2>{{ pageTitle }}</h2>

  <div *ngIf="isLoading" class="loading-indicator">Cargando...</div>
  <div *ngIf="error" class="alert alert-danger">{{ error }}</div>

  <form [formGroup]="direccionForm" (ngSubmit)="guardarDireccion()" *ngIf="!isLoading">
    <div class="mb-3">
      <label for="calle" class="form-label">Calle:</label>
      <input type="text" id="calle" class="form-control" formControlName="calle"
             [ngClass]="{ 'is-invalid': calle?.invalid && (calle?.dirty || calle?.touched) }">
      <div *ngIf="calle?.invalid && (calle?.dirty || calle?.touched)" class="invalid-feedback">
        <div *ngIf="calle?.errors?.['required']">La calle es obligatoria.</div>
      </div>
    </div>

    <div class="mb-3">
      <label for="ciudad" class="form-label">Ciudad:</label>
      <input type="text" id="ciudad" class="form-control" formControlName="ciudad"
             [ngClass]="{ 'is-invalid': ciudad?.invalid && (ciudad?.dirty || ciudad?.touched) }">
      <div *ngIf="ciudad?.invalid && (ciudad?.dirty || ciudad?.touched)" class="invalid-feedback">
        <div *ngIf="ciudad?.errors?.['required']">La ciudad es obligatoria.</div>
      </div>
    </div>

    <div class="mb-3">
      <label for="cp" class="form-label">Código Postal:</label>
      <input type="text" id="cp" class="form-control" formControlName="cp"
             [ngClass]="{ 'is-invalid': cp?.invalid && (cp?.dirty || cp?.touched) }">
      <div *ngIf="cp?.invalid && (cp?.dirty || cp?.touched)" class="invalid-feedback">
        <div *ngIf="cp?.errors?.['required']">El código postal es obligatorio.</div>
        <div *ngIf="cp?.errors?.['pattern']">El código postal debe ser de 5 dígitos.</div>
      </div>
    </div>

    <div class="mb-3">
      <label for="pais" class="form-label">País:</label>
      <input type="text" id="pais" class="form-control" formControlName="pais"
             [ngClass]="{ 'is-invalid': pais?.invalid && (pais?.dirty || pais?.touched) }">
      <div *ngIf="pais?.invalid && (pais?.dirty || pais?.touched)" class="invalid-feedback">
        <div *ngIf="pais?.errors?.['required']">El país es obligatorio.</div>
      </div>
    </div>

    <div class="mb-3 form-check">
      <input type="checkbox" id="predeterminada" class="form-check-input" formControlName="predeterminada">
      <label class="form-check-label" for="predeterminada">Marcar como dirección predeterminada</label>
    </div>

    <div class="d-flex justify-content-end">
      <button type="button" (click)="cancelar()" class="btn btn-secondary me-2">Cancelar</button>
      <button type="submit" class="btn btn-primary" [disabled]="direccionForm.invalid || isLoading">
        {{ isEditMode ? 'Actualizar Dirección' : 'Guardar Dirección' }}
      </button>
    </div>
  </form>
</div>
